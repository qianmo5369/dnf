{"version":3,"names":["loginType","common_vendor","ref","countdown","isChecked","phone","password","code","sendCode","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","res","wrap","_callee$","_context","prev","next","value","abrupt","index","showToast","title","icon","$http","post","mobile","event","sent","msg","stop","apply","arguments","handleLogin","_ref2","_callee2","token","userStore","_callee2$","_context2","captcha","account","setStorageSync","data","userinfo","stores_user","useUserStore","setToken","fetchUserInfo","reLaunch","url","wx","createPage","MiniProgramPage"],"sources":["login.vue","login.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"login-page\">\r\n\t\t<view class=\"login-box\">\r\n\t\t\t<text class=\"login-title\">欢迎登录</text>\r\n\r\n\r\n\t\t\t<input class=\"input\" v-model=\"phone\" placeholder=\"请输入账号\" />\r\n\t\t\t<view v-if=\"loginType === 'account'\">\r\n\t\t\t\t<input class=\"input\" v-model=\"password\" placeholder=\"请输入密码\" password />\r\n\t\t\t</view>\r\n\r\n\t\t\t<view v-else>\r\n\t\t\t\t<view class=\"input-wrapper\">\r\n\t\t\t\t\t<input class=\"input full\" placeholder=\"请输入验证码\" />\r\n\t\t\t\t\t<text class=\"send-code-text\" :class=\"{ disabled: countdown > 0 }\" @click=\"sendCode\">\r\n\t\t\t\t\t\t{{ countdown > 0 ? countdown + 's后重试' : '发送验证码' }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<button class=\"login-btn\" @click=\"handleLogin\">登录</button>\n\t\t\t<button @click=\"mpLogin1()\">微信一键登录</button>\r\n\r\n\t\t\t<view class=\"login-switch\">\r\n\t\t\t\t<text :class=\"{ active: loginType === 'account' }\" v-if=\"loginType === 'account'\"\r\n\t\t\t\t\t@click=\"loginType = 'code'\">验证码登录</text>\r\n\t\t\t\t<text :class=\"{ active: loginType === 'code' }\" v-else @click=\"loginType = 'account'\">账号密码登录</text>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"agreement-check\">\r\n\t\t\t\t<radio :checked=\"isChecked\" style=\"transform: scale(.7);\" @click=\"isChecked = !isChecked\"></radio>\r\n\t\t\t\t<!-- <checkbox :checked=\"isChecked\" @click=\"isChecked = !isChecked\" class=\"checkbox\" /> -->\r\n\t\t\t\t<view class=\"agreement-text\">\r\n\t\t\t\t\t登录即代表您已同意 <text class=\"link\">《用户协议》</text> 和 <text class=\"link\">《隐私政策》</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"wechat-login\" @click=\"mpLogin1\">\r\n\t\t\t\t<image src=\"https://dnf.hanyunkeji.cn/static/wechat_login.png\" class=\"wechat-icon\" />\r\n\t\t\t\t<text class=\"wechat-text\">微信一键登录</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref\r\n\t} from 'vue'\r\n\t// import { showToast } from '@dcloudio/uni-ui'\r\n\timport {\r\n\t\tuseUserStore\r\n\t} from '@/stores/user'\r\n\tconst loginType = ref('account')\r\n\tconst countdown = ref(0)\r\n\tconst isChecked = ref(true)\r\n\tconst phone = ref('')\r\n\tconst password = ref('')\r\n\tconst code = ref('')\r\n\tlet timer = null;\r\n\r\n\tconst sendCode = async () => {\r\n\t\tif (countdown.value > 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!phone.value) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请输入手机号',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst res = await uni.$http.post('/sms/send', {\r\n\t\t\tmobile: phone.value,\r\n\t\t\tevent: 'mobilelogin'\r\n\t\t})\r\n\r\n\t\tif (res.code === 1) {\r\n\t\t\tcountdown.value = 60;\r\n\t\t\t// timer = setInterval(() => {\r\n\t\t\t// \tcountdown.value--\r\n\t\t\t// \tif (countdown.value <= 0) clearInterval(timer)\r\n\t\t\t// }, 1000)\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tconst handleLogin = async () => {\r\n\t\tif (!isChecked.value) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请先勾选同意协议',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (!phone.value) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请输入手机号',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (loginType.value === 'code') {\r\n\t\t\tif (!code.value) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请输入验证码',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (!password.value) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请输入密码',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (loginType.value == 'code') {\r\n\t\t\tvar res = await uni.$http.post('/user/mobilelogin', {\r\n\t\t\t\tmobile: phone.value,\r\n\t\t\t\tcaptcha: code.value,\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tvar res = await uni.$http.post('/user/login', {\r\n\t\t\t\taccount: phone.value,\r\n\t\t\t\tpassword: password.value,\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tif (res.code === 1) {\r\n\t\t\tuni.setStorageSync('token', res.data.userinfo.token);\r\n\r\n\t\t\tconst token = res.data.userinfo.token\r\n\t\t\tconst userStore = useUserStore()\r\n\t\t\tuserStore.setToken(token)\r\n\t\t\tawait userStore.fetchUserInfo()\r\n\t\t\tuni.reLaunch({\r\n\t\t\t\turl: '/pages/index/index'\r\n\t\t\t})\r\n\r\n\t\t\t// uni.showToast({\r\n\t\t\t// \ttitle: res.msg,\r\n\t\t\t// \ticon: 'none'\r\n\t\t\t// })\r\n\t\t\tuni.reLaunch({\r\n\t\t\t\turl: '/pages/index/index'\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\n\t\n\t\n\tconst mpLogin =  () => {\n\t\tuni.login({\n\t\t\tsuccess:  async (loginRes) => {\n\t\t\t\tconst res = await uni.$http.post('/user/mpLogin', {\n\t\t\t\t\t'code': loginRes.code,\n\t\t\t\t\t'anonymousCode': loginRes.anonymousCode,\n\t\t\t\t})\n\t\n\t\n\t\t\t\tif (res.code === 1) {\n\t\t\t\t\tuni.setStorageSync('token', res.data.userinfo.token);\n\t\n\t\t\t\t\tconst token = res.data.userinfo.token\n\t\t\t\t\tconst userStore = useUserStore()\n\t\t\t\t\tuserStore.setToken(token)\n\t\t\t\t\tawait userStore.fetchUserInfo()\n\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\turl: '/pages/index/index'\n\t\t\t\t\t})\n\t\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: res.msg,\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\turl: '/pages/index/index'\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: res.msg,\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t.login-page {\r\n\t\tbackground: #ffffff;\r\n\t\tpadding: 120rpx 40rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.login-box {\r\n\t\twidth: 100%;\r\n\t\tmax-width: 640rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 24rpx;\r\n\t\tpadding: 60rpx 30rpx;\r\n\t\t/* box-shadow: 0 8rpx 20rpx rgba(0, 0, 0, 0.05); */\r\n\t}\r\n\r\n\t.login-title {\r\n\t\tfont-size: 40rpx;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-bottom: 50rpx;\r\n\t\tcolor: #222;\r\n\t\ttext-align: left;\r\n\t\tmargin-top: 120rpx;\r\n\r\n\t}\r\n\r\n\t.input {\r\n\t\twidth: 100%;\r\n\t\tbackground: #f5f7fa;\r\n\t\theight: 90rpx;\r\n\t\tborder-radius: 60rpx;\r\n\t\tpadding: 20rpx 24rpx;\r\n\t\tfont-size: 26rpx;\r\n\t\tmargin-bottom: 50rpx;\r\n\t}\r\n\r\n\t.input-wrapper {\r\n\t\tposition: relative;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\r\n\t.input.full {\r\n\t\twidth: 100%;\r\n\t\tpadding-right: 160rpx;\r\n\t}\r\n\r\n\t.send-code-text {\r\n\t\tposition: absolute;\r\n\t\tright: 24rpx;\r\n\t\ttop: 50%;\r\n\t\ttransform: translateY(-50%);\r\n\t\tcolor: #1677ff;\r\n\t\tfont-size: 24rpx;\r\n\t}\r\n\r\n\t.send-code-text.disabled {\r\n\t\tcolor: #ccc;\r\n\t}\r\n\r\n\t.login-btn {\r\n\t\twidth: 100%;\r\n\t\tbackground: #1677ff;\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 28rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t\tpadding: 5rpx 0;\r\n\t\tmargin-top: 70rpx;\r\n\t\tmargin-bottom: 12rpx;\r\n\t}\r\n\r\n\t.login-switch {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tmargin: 30rpx 0;\r\n\t\tfont-size: 26rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.login-switch .active {\r\n\t\tcolor: #1677ff;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.divider {\r\n\t\tmargin: 0 16rpx;\r\n\t\tcolor: #ccc;\r\n\t}\r\n\r\n\t.agreement-check {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tfont-size: 22rpx;\r\n\t\tcolor: #999;\r\n\t\tmargin-bottom: 40rpx;\r\n\t\ttext-align: center;\r\n\t\tgap: 12rpx;\r\n\t}\r\n\r\n\t.checkbox {\r\n\t\ttransform: scale(0.8);\r\n\t\tborder-radius: 50%;\r\n\t\tbackground-color: #fff;\r\n\t\tborder: 2rpx solid #ccc;\r\n\t\twidth: 32rpx;\r\n\t\theight: 32rpx;\r\n\t}\r\n\r\n\t.link {\r\n\t\tcolor: #1677ff;\r\n\t}\r\n\r\n\t.wechat-login {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tmargin-top: 20rpx;\r\n\t}\r\n\r\n\t.wechat-icon {\r\n\t\twidth: 72rpx;\r\n\t\theight: 72rpx;\r\n\t\tmargin-bottom: 8rpx;\r\n\t}\r\n\r\n\t.wechat-text {\r\n\t\tfont-size: 22rpx;\r\n\t\tcolor: #888;\r\n\t}\r\n</style>","import MiniProgramPage from '/Users/zhizhi/Documents/HBuilderProjects/dnf/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}