{"version":3,"names":["fuiUpload","room_id","common_vendor","ref","uploadUrl","util_env","baseUrl","selectedIds","uploadStatus","reason","imageUrl","targets","onLoad","params","value","index","showToast","title","icon","onMounted","getComplaintTargets","selectRole","includes","filter","i","push","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","res","wrap","_callee$","_context","prev","next","$http","post","sent","code","data","stop","apply","arguments","uploadSuccess","e","__f__","JSON","parse","replace","status","url","settlementImage","uploadError","showModal","content","stringify","submitAppeal","_ref2","_callee2","_callee2$","_context2","length","abrupt","trim","target_ids","map","user_id","images","$toast","wx","createPage","MiniProgramPage"],"sources":["send.vue","send.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"appeal-form-page\">\r\n\t\t<!-- 选择被投诉人 -->\r\n\t\t<view class=\"form-section\">\r\n\t\t\t<text class=\"label required\">被投诉人</text>\r\n\t\t\t<view class=\"role-list\">\r\n\t\t\t\t<view v-for=\"(role,index) in targets\" :key=\"index\" class=\"role-card\" :class=\"{ selected: selectedIds.includes(index) }\"\r\n\t\t\t\t\t  @click=\"selectRole(index)\">\r\n\t\t\t\t\t<tn-avatar :url=\"role.hero_avatar\" size=\"80rpx\" />\r\n\t\t\t\t\t<view class=\"role-info\">\r\n\t\t\t\t\t\t<view class=\"role-value\">{{ role.resist_power }} {{ role.hero_name }}</view>\r\n\t\t\t\t\t\t<view class=\"role-subtitle\">{{role.user_nickname}}</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 输入投诉内容 -->\r\n\t\t<view class=\"form-section\">\r\n\t\t\t<text class=\"label required\">投诉内容</text>\r\n\t\t\t<textarea class=\"textarea\" v-model=\"reason\" placeholder=\"请输入投诉的详细内容\" />\r\n\t\t</view>\r\n\r\n\t\t<!-- 上传截图 -->\r\n\t\t<view class=\"form-section\">\r\n\t\t\t<text class=\"label\">凭证补充</text>\r\n\t\t\t<view class=\"upload-box\">\r\n\t\t\t\t<fui-upload borderColor=\"#eee\" background=\"#Fff\" radius=\"10\" immediate width=\"200\" height=\"200\"\r\n\t\t\t\t\t:url=\"uploadUrl\" :max=\"3                                                                                                                                                                                                                                                                          \" ref=\"uploadRef\" @success=\"uploadSuccess\"\r\n\t\t\t\t\t@error=\"uploadError\"></fui-upload>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 提交按钮 -->\r\n\t\t<view class=\"bottom-btn\">\r\n\t\t\t<view class=\"submit-btn\" @tap=\"submitAppeal\">提交申诉</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\n\t\tonMounted\r\n\t} from 'vue'\r\n\timport {\r\n\t\tbaseUrl\r\n\t} from \"@/util/env\";\r\n\timport {\r\n\t\tonShow,\r\n\t\tonLoad\r\n\t} from '@dcloudio/uni-app';\n\timport fuiUpload from \"@/components/fui-upload.vue\"\r\n\tconst room_id = ref(null)\n\tconst uploadUrl = baseUrl + '/common/upload';\n\tconst selectedIds = ref([])\n\tconst uploadStatus = ref(false);\r\n\tconst reason = ref('')\r\n\tconst imageUrl = ref('')\r\n\tconst targets = ref([\r\n\r\n\t])\r\n\tonLoad((params) => {\r\n\t\tif (params.room_id) {\r\n\t\t\troom_id.value = params.room_id;\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: \"房间不存在\",\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t})\n\t\n\tonMounted(() => {\n\t\tgetComplaintTargets()\n\t})\n\t\n\t\r\n\tconst selectRole = (index)=>{\n\t\tif (selectedIds.value.includes(index)) {\n\t\t    selectedIds.value = selectedIds.value.filter(i => i !== index)\n\t\t  } else {\n\t\t    selectedIds.value.push(index)\n\t\t  }\n\t}\r\n\r\n\tconst getComplaintTargets = async () => {\r\n\t\tconst res = await uni.$http.post('/room/getComplaintTargets', {room_id: room_id.value})\r\n\t\tif (res.code === 1) {\r\n\t\t\ttargets.value = res.data;\r\n\t\t}\r\n\t}\r\n\tfunction chooseImage() {\r\n\t\tuni.chooseImage({\r\n\t\t\tcount: 1,\r\n\t\t\tsuccess(res) {\r\n\t\t\t\timageUrl.value = res.tempFilePaths[0]\r\n\t\t\t}\r\n\t\t})\r\n\t}\n\t\n\tconst uploadSuccess = (e) => {\n\t\tconsole.log(e)\n\t\t//上传成功回调，处理服务器返回数据【此处根据实际返回数据进行处理】\n\t\tlet res = JSON.parse(e.res.data.replace(/\\ufeff/g, \"\") || \"{}\")\n\t\tuploadStatus.value = e.status\n\t\tif (res.data.url) {\n\t\t\tsettlementImage.value = res.data.url;\n\t\t}\n\t}\n\t\n\tconst uploadError = (e) => {\n\t\tuploadStatus.value = e.status\n\t\tuni.showModal({\n\t\t\tcontent: JSON.stringify(e)\n\t\t})\n\t}\r\n\r\n\tconst submitAppeal =  async () =>{\n\t\tif (selectedIds.value.length === 0) {\n\t\t    return uni.showToast({ title: '请选择被投诉人', icon: 'none' })\n\t\t  }\r\n\t\tif (!reason.value.trim()) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请填写投诉内容',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\n\t\t\n\n\t\tconst res = await uni.$http.post('/room/submitComplaint', {\n\t\t    room_id: room_id.value,\n\t\t    target_ids: selectedIds.value.map(i => targets.value[i].user_id),\n\t\t    reason: reason.value,\n\t\t    images: imageUrl.value\n\t\t  })\n\t\tif (res.code === 1) {\n\t\t\tuni.$toast('ok')\n\t\t}\r\n\t}\r\n</script>\r\n<style scoped>\r\n\t.appeal-form-page {\r\n\t\tpadding: 30rpx;\r\n\t\tbackground-color: #fff;\r\n\t\t/* min-height: 100vh; */\r\n\t}\r\n\r\n\t.form-header {\r\n\t\ttext-align: center;\r\n\t\tmargin-bottom: 40rpx;\r\n\t}\r\n\r\n\t.form-title {\r\n\t\tfont-size: 36rpx;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.label {\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #333;\r\n\t\tmargin: 20rpx 0rpx;\r\n\t\tdisplay: block;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\r\n\t.label.required::before {\r\n\t\tcontent: '*';\r\n\t\tcolor: red;\r\n\t\tmargin-right: 6rpx;\r\n\t}\r\n\r\n\t.complain-target {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tbackground: #f5f5f5;\r\n\t\tborder-radius: 12rpx;\r\n\t\tpadding: 20rpx;\r\n\t}\r\n\r\n\t.avatar {\r\n\t\twidth: 80rpx;\r\n\t\theight: 80rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\r\n\t.info .name {\r\n\t\tfont-size: 30rpx;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.info .sub {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.textarea {\r\n\t\twidth: 100%;\r\n\t\theight: 200rpx;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 12rpx;\r\n\t\tpadding: 20rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tborder: 2rpx solid #f7f7f7;\r\n\t}\r\n\r\n\t.upload-box {\r\n\t\t/* background: #f7f7f7; */\r\n\t\tborder-radius: 16rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\n\t\tflex-wrap: wrap;\r\n\t\t/* justify-content: center; */\r\n\t}\r\n\r\n\t.upload-placeholder {\r\n\t\tfont-size: 60rpx;\r\n\t\tcolor: #ccc;\r\n\t}\r\n\r\n\t.preview {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tborder-radius: 12rpx;\r\n\t}\r\n\r\n\t.bottom-btn {\r\n\t\tmargin-top: 80rpx;\r\n\t}\r\n\r\n\t.submit-btn {\r\n\t\tbackground: #007aff;\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 28rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t\tpadding: 25rpx 0;\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t.role-list {\r\n\t\tdisplay: grid;\r\n\t\tgrid-template-columns: repeat(2, 1fr);\r\n\t\tgrid-gap: 20rpx;\r\n\t\t/* padding: 30rpx; */\r\n\t\tmargin-top: 30rpx;\r\n\t}\r\n\r\n\t/* 单个角色卡片 */\r\n\t.role-card {\r\n\t\tposition: relative;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 16rpx;\r\n\t\tpadding: 20rpx;\r\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n\t\toverflow: hidden;\n\t\tborder: 2rpx solid transparent;\r\n\t}\r\n\r\n\t/* 三角形背景——尖朝左下，位于右上角 */\r\n\t.card-active::before {\r\n\t\tcontent: \"\";\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tright: 0;\r\n\t\twidth: 90rpx;\r\n\t\t/* 三角边长 */\r\n\t\theight: 60rpx;\r\n\t\tbackground-color: #409eff;\r\n\t\tclip-path: polygon(100% 0%,\r\n\t\t\t\t/* 顶点：右上 */\r\n\t\t\t\t100% 100%,\r\n\t\t\t\t/* 底点：右下 */\r\n\t\t\t\t0% 0%\r\n\t\t\t\t/* 左顶点：左上 */\r\n\t\t\t);\r\n\t}\r\n\r\n\t/* 对勾 */\r\n\t.card-active::after {\r\n\t\tcontent: \"当前\";\r\n\t\tposition: absolute;\r\n\t\ttop: 4rpx;\r\n\t\tright: 4rpx;\r\n\t\tfont-size: 20rpx;\r\n\t\t/* line-height: 50rpx; */\r\n\t\tcolor: #fff;\r\n\t\t/* line-height: 2; */\r\n\t}\r\n\r\n\t/* 文字区域 */\r\n\t.role-info {\r\n\t\tmargin-left: 20rpx;\r\n\t}\r\n\r\n\t.role-value {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.role-subtitle {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #888;\r\n\t\tmargin-top: 8rpx;\r\n\t}\n\t\n\t.selected {\n\t  border: 2rpx solid #2e89ff;\n\t  background: #e6f0ff;\n\t}\r\n</style>","import MiniProgramPage from '/Users/zhizhi/Documents/HBuilderProjects/dnf/pages/complaint/send.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}