{"version":3,"file":"Roles.js","sources":["components/Roles.vue","/Users/zhizhi/Documents/HBuilderProjects/dnf/components/Roles.vue?type=component"],"sourcesContent":["<template>\r\n\t<!-- 标题 -->\r\n\t<view class=\"wrap\">\r\n\t\t<view class=\"popup-header\">选择角色</view>\r\n\t\t<view class=\"fui-icon__close\" @tap=\"onClose\">\r\n\t\t\t<TnIcon name=\"close\" />\r\n\t\t</view>\r\n\r\n\t\t<scroll-view scroll-y class=\"popup-body\">\r\n\t\t\t<view class=\"role-list\">\r\n\t\t\t\t<view v-for=\"(role,index) in userHeroList\" :key=\"index\" class=\"role-card\" :class=\"{ 'card-active': activeRoleId === role.id }\" @click=\"selectRole(role)\">\r\n\t\t\t\t\t<tn-avatar :url=\"role.hero_avatar\" size=\"80rpx\" />\r\n\t\t\t\t\t<view class=\"role-info\">\r\n\t\t\t\t\t\t<view class=\"role-value\">{{ role.resist_power }} {{ role.hero_name }}</view>\r\n\t\t\t\t\t\t<view class=\"role-subtitle\">{{role.nickname}}</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\r\n\t\t<!-- 底部自定义按钮组 -->\r\n\t\t<view class=\"popup-footer\">\r\n\t\t\t<view class=\"btn btn-default\" @click=\"linkTo('/pages/hero/hero')\">管理角色</view>\r\n\t\t\t<view class=\"btn btn-primary\" @click=\"linkTo('/pages/hero/edit')\">新建角色</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tdefineProps,\r\n\t\tdefineEmits,\n\t\tonMounted\r\n\t} from 'vue'\n\timport { onShow } from '@dcloudio/uni-app';\r\n\timport TnIcon from '@/uni_modules/tuniaoui-vue3/components/icon/src/icon.vue'\r\n\timport TnButton from '@/uni_modules/tuniaoui-vue3/components/button/src/button.vue'\r\n\timport TnAvatar from '@/uni_modules/tuniaoui-vue3/components/avatar/src/avatar.vue'\r\n\timport TnPopup from '@/uni_modules/tuniaoui-vue3/components/popup/src/popup.vue'\n\timport { useUserStore } from '@/stores/user'\n\tconst userStore = useUserStore()\r\n\tconst show = ref(true)\r\n\tconst props = defineProps({\r\n\t\tmodelValue: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t}\r\n\t})\r\n\tconst emit = defineEmits(['update:modelValue'])\r\n\r\n\tfunction onClose() {\r\n\t\temit('update:modelValue', false)\r\n\t}\r\n\r\n\tconst userHeroList = ref([])\r\n\r\n\tconst activeRoleId = ref(1)\n\t\n\tconst  selectRole = async (role) => {\n\t  activeRoleId.value = role.id\n\t  const res = await uni.$http.post('/dungeon/setDefaultUserHero',{\n\t\t  hero_id:role.id\n\t  })\n\t  \t\n\t  if (res.code === 1) {\n\t\t  const userStore = useUserStore()\n\t\t  await userStore.fetchUserInfo()\n\t  \tonClose()\n\t  } else {\n\t  \tuni.showToast({\n\t  \t\ttitle: res.msg,\n\t  \t\ticon: 'none'\n\t  \t})\n\t  }\n\t}\r\n\r\n\tconst linkTo = (path)=>{\n\t\tuni.navigateTo({\n\t\t\turl: path\n\t\t})\n\t}\n\t\n\tconst getUserHeroList = async () => {\n\t\t\n\t\tconst res = await uni.$http.get('/dungeon/getUserHeroList')\n\t\n\t\tif (res.code === 1) {\n\t\t\tuserHeroList.value = res.data;\n\t\t\tif (userStore.userInfo?.default_user_hero_id) {\n\t\t\t    activeRoleId.value = userStore.userInfo.default_user_hero_id\n\t\t\t  }\n\t\t} else {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: res.msg,\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t}\n\t\n\tonMounted(() => {\n\t\tgetUserHeroList()\n\t})\n\t\n\tonShow(() => {\n\t\tgetUserHeroList()\n\t})\r\n</script>\r\n\r\n<style scoped>\r\n\t.wrap {\r\n\t\tposition: relative;\r\n\t\theight: 1000rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\t/* background: #fff; */\r\n\t}\r\n\r\n\t.btn {\r\n\t\tflex: 1;\r\n\t\tmargin: 0 10rpx;\r\n\t\tpadding: 20rpx 0;\r\n\t\ttext-align: center;\r\n\t\tborder-radius: 10rpx;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n\r\n\t/* 默认按钮 */\r\n\t.btn-default {\r\n\t\tbackground-color: #fff;\r\n\t\tcolor: #3366ff;\r\n\t\tborder: 1rpx solid #3366ff;\r\n\t}\r\n\r\n\t/* 主要按钮 */\r\n\t.btn-primary {\r\n\t\tbackground-color: #3366ff;\r\n\t\tcolor: #fff;\r\n\t}\r\n\r\n\t/* 弹窗头 */\r\n\t.popup-header {\r\n\t\ttext-align: center;\r\n\t\tfont-size: 30rpx;\r\n\t\tpadding: 24rpx;\r\n\t\tcolor: #3366ff;\r\n\t\tborder-bottom: 1rpx solid #eee;\r\n\t}\r\n\r\n\t/* 主体滚动区 */\r\n\t.popup-body {\r\n\t\theight: 800rpx;\t\r\n\t\tpadding: 0rpx 30rpx;\n\t\tbackground-color: #f8f7f8;\r\n\t}\r\n\r\n\t/* 原生 CSS Grid 两列布局 */\r\n\t.role-list {\r\n\t\tdisplay: grid;\r\n\t\tgrid-template-columns: repeat(2, 1fr);\r\n\t\tgrid-gap: 20rpx;\n\t\t/* padding: 30rpx; */\n\t\tmargin-top: 30rpx;\r\n\t}\r\n\r\n\t/* 单个角色卡片 */\r\n\t.role-card {\n\t\tposition: relative;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 16rpx;\r\n\t\tpadding: 20rpx;\r\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n\t\toverflow: hidden;\r\n\t}\n\t\n\t/* 三角形背景——尖朝左下，位于右上角 */\n\t.card-active::before {\n\t  content: \"\";\n\t  position: absolute;\n\t  top: 0;\n\t  right: 0;\n\t  width: 90rpx;   /* 三角边长 */\n\t  height: 60rpx;\n\t  background-color: #409eff;\n\t  clip-path: polygon(\n\t    100% 0%,    /* 顶点：右上 */\n\t    100% 100%,  /* 底点：右下 */\n\t    0% 0%       /* 左顶点：左上 */\n\t  );\n\t}\n\t\n\t/* 对勾 */\n\t.card-active::after {\n\t  content: \"当前\";\n\t  position: absolute;\n\t  top: 4rpx;\n\t  right: 4rpx;\n\t  font-size: 20rpx;\n\t  /* line-height: 50rpx; */\n\t  color: #fff;\n\t  /* line-height: 2; */\n\t}\r\n\t/* 文字区域 */\r\n\t.role-info {\r\n\t\tmargin-left: 20rpx;\r\n\t}\r\n\r\n\t.role-value {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.role-subtitle {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #888;\r\n\t\tmargin-top: 8rpx;\r\n\t}\r\n\r\n\t/* 底部按钮区 */\r\n\t.popup-footer {\r\n\t\t/* position: absolute; */\r\n\t\t/* bottom: 120rpx;\r\n\t\t */\r\n\t\t/* #ifdef APP */\r\n\t\tbottom: calc(env(safe-area-inset-bottom) - 40rpx);\r\n\t\t/* #endif */\r\n\r\n\t\t/* #ifdef H5 */\r\n\t\tbottom: var(--window-bottom);\r\n\t\t/* #endif */\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\r\n\t\tpadding: 20rpx;\r\n\t\tflex-direction: row;\r\n\t\tdisplay: flex;\r\n\t\tpadding: 20rpx;\r\n\t\tbackground: #fff;\r\n\t\t/* border-top: 1rpx solid #eee; */\r\n\t}\r\n\r\n\t.fui-icon__close {\r\n\t\tposition: absolute;\r\n\t\ttop: 24rpx;\r\n\t\tright: 54rpx;\r\n\r\n\t}\r\n\t/* .role-list > .role-card:nth-child(-n+2) {\n\t  margin-top: 20rpx;\n\t}\r\n\t.role-list>.role-card:last-child {\r\n\t\tmargin-bottom: 150rpx;\r\n\t} */\r\n</style>","import Component from '/Users/zhizhi/Documents/HBuilderProjects/dnf/components/Roles.vue'\nwx.createComponent(Component)"],"names":["useUserStore","ref","uni","userStore","onMounted","onShow"],"mappings":";;;;;;AAmCC,MAAM,SAAS,MAAW;AAE1B,MAAM,WAAW,MAAW;;;;;;;;;;;AAG5B,UAAM,YAAYA,YAAAA,aAAc;AACnBC,kBAAAA,IAAI,IAAI;AAOrB,UAAM,OAAO;AAEb,aAAS,UAAU;AAClB,WAAK,qBAAqB,KAAK;AAAA,IAC/B;AAED,UAAM,eAAeA,cAAG,IAAC,EAAE;AAE3B,UAAM,eAAeA,cAAG,IAAC,CAAC;AAE1B,UAAO,aAAa,OAAO,SAAS;AAClC,mBAAa,QAAQ,KAAK;AAC1B,YAAM,MAAM,MAAMC,cAAAA,MAAI,MAAM,KAAK,+BAA8B;AAAA,QAC9D,SAAQ,KAAK;AAAA,MACjB,CAAI;AAED,UAAI,IAAI,SAAS,GAAG;AACnB,cAAMC,aAAYH,YAAAA,aAAc;AAChC,cAAMG,WAAU,cAAe;AAC/B,gBAAS;AAAA,MACb,OAAU;AACND,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,IAAI;AAAA,UACX,MAAM;AAAA,QACX,CAAK;AAAA,MACD;AAAA,IACF;AAED,UAAM,SAAS,CAAC,SAAO;AACtBA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,MACR,CAAG;AAAA,IACD;AAED,UAAM,kBAAkB,YAAY;;AAEnC,YAAM,MAAM,MAAMA,cAAAA,MAAI,MAAM,IAAI,0BAA0B;AAE1D,UAAI,IAAI,SAAS,GAAG;AACnB,qBAAa,QAAQ,IAAI;AACzB,aAAI,eAAU,aAAV,mBAAoB,sBAAsB;AAC1C,uBAAa,QAAQ,UAAU,SAAS;AAAA,QACzC;AAAA,MACN,OAAS;AACNA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,IAAI;AAAA,UACX,MAAM;AAAA,QACV,CAAI;AAAA,MACD;AAAA,IACD;AAEDE,kBAAAA,UAAU,MAAM;AACf,sBAAiB;AAAA,IACnB,CAAE;AAEDC,kBAAAA,OAAO,MAAM;AACZ,sBAAiB;AAAA,IACnB,CAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxGF,GAAG,gBAAgB,SAAS;"}