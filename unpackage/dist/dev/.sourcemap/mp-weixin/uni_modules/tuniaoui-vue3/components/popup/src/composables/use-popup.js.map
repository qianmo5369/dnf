{"version":3,"file":"use-popup.js","sources":["uni_modules/tuniaoui-vue3/components/popup/src/composables/use-popup.ts"],"sourcesContent":["import { computed, getCurrentInstance, ref, watch } from 'vue'\nimport { UPDATE_MODEL_EVENT } from '../../../../constants'\n\nimport type { PopupProps } from '../popup'\n\nexport const usePopup = (props: PopupProps) => {\n  const { emit } = getCurrentInstance()!\n  const iosDevice = computed<boolean>(() => {\n    const systemInfo = uni.getSystemInfoSync()\n    return systemInfo.osName === 'ios' || systemInfo.osName === 'macos'\n  })\n\n  // 是否显示遮罩层\n  const showOverlay = ref(false)\n  // 是否显示弹框\n  const showPopup = ref(false)\n  const visiblePopup = ref(false)\n  let initPopupModelValue = false\n  watch(\n    () => props.modelValue,\n    (value) => {\n      if (value) {\n        visiblePopup.value = true\n        if (iosDevice.value) {\n          setTimeout(() => {\n            showPopup.value = true\n            if (props.overlay) showOverlay.value = true\n            initPopupModelValue && emit('open')\n          }, 0)\n        } else {\n          showPopup.value = true\n          if (props.overlay) showOverlay.value = true\n          initPopupModelValue && emit('open')\n        }\n      } else {\n        showPopup.value = false\n        showOverlay.value = false\n        setTimeout(() => {\n          visiblePopup.value = false\n        }, 250)\n        initPopupModelValue && emit('close')\n      }\n      initPopupModelValue = true\n    },\n    {\n      immediate: true,\n    }\n  )\n\n  // 更新模态框的状态\n  const updateModelValue = (value: boolean) => {\n    emit(UPDATE_MODEL_EVENT, value)\n  }\n\n  // 点击关闭按钮\n  const onClickCloseBtn = () => {\n    updateModelValue(false)\n    emit('close')\n  }\n\n  // 点击遮罩层关闭模态框\n  const onClickOverlay = () => {\n    if (props.overlayCloseable) {\n      updateModelValue(false)\n      emit('close')\n      emit('overlay-click')\n    }\n  }\n\n  return {\n    iosDevice,\n    showOverlay,\n    showPopup,\n    visiblePopup,\n    updateModelValue,\n    onClickCloseBtn,\n    onClickOverlay,\n  }\n}\n"],"names":["getCurrentInstance","computed","uni","ref","watch","UPDATE_MODEL_EVENT"],"mappings":";;;AAKa,MAAA,WAAW,CAAC,UAAsB;AACvC,QAAA,EAAE,SAASA,cAAAA;AACX,QAAA,YAAYC,cAAAA,SAAkB,MAAM;AAClC,UAAA,aAAaC,oBAAI;AACvB,WAAO,WAAW,WAAW,SAAS,WAAW,WAAW;AAAA,EAAA,CAC7D;AAGK,QAAA,cAAcC,kBAAI,KAAK;AAEvB,QAAA,YAAYA,kBAAI,KAAK;AACrB,QAAA,eAAeA,kBAAI,KAAK;AAC9B,MAAI,sBAAsB;AAC1BC,gBAAA;AAAA,IACE,MAAM,MAAM;AAAA,IACZ,CAAC,UAAU;AACT,UAAI,OAAO;AACT,qBAAa,QAAQ;AACrB,YAAI,UAAU,OAAO;AACnB,qBAAW,MAAM;AACf,sBAAU,QAAQ;AAClB,gBAAI,MAAM;AAAS,0BAAY,QAAQ;AACvC,mCAAuB,KAAK,MAAM;AAAA,aACjC,CAAC;AAAA,QAAA,OACC;AACL,oBAAU,QAAQ;AAClB,cAAI,MAAM;AAAS,wBAAY,QAAQ;AACvC,iCAAuB,KAAK,MAAM;AAAA,QACpC;AAAA,MAAA,OACK;AACL,kBAAU,QAAQ;AAClB,oBAAY,QAAQ;AACpB,mBAAW,MAAM;AACf,uBAAa,QAAQ;AAAA,WACpB,GAAG;AACN,+BAAuB,KAAK,OAAO;AAAA,MACrC;AACsB,4BAAA;AAAA,IACxB;AAAA,IACA;AAAA,MACE,WAAW;AAAA,IACb;AAAA,EAAA;AAII,QAAA,mBAAmB,CAAC,UAAmB;AAC3C,SAAKC,yCAAAA,oBAAoB,KAAK;AAAA,EAAA;AAIhC,QAAM,kBAAkB,MAAM;AAC5B,qBAAiB,KAAK;AACtB,SAAK,OAAO;AAAA,EAAA;AAId,QAAM,iBAAiB,MAAM;AAC3B,QAAI,MAAM,kBAAkB;AAC1B,uBAAiB,KAAK;AACtB,WAAK,OAAO;AACZ,WAAK,eAAe;AAAA,IACtB;AAAA,EAAA;AAGK,SAAA;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;;"}