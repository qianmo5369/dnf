{"version":3,"file":"image-upload.js","sources":["uni_modules/tuniaoui-vue3/components/image-upload/src/image-upload.ts","uni_modules/tuniaoui-vue3/components/image-upload/src/image-upload.vue","/Users/zhizhi/Documents/HBuilderProjects/dnf/uni_modules/tuniaoui-vue3/components/image-upload/src/image-upload.vue?type=component"],"sourcesContent":["import { CHANGE_EVENT, UPDATE_MODEL_EVENT } from '../../../constants'\nimport { buildProps, definePropType, isArray } from '../../../utils'\n\nimport type { ExtractPropTypes } from 'vue'\nimport type { ImageUploadFile, ImageUploadListItem } from './types'\n\nexport const imageUploadSizeTypes = ['original', 'compressed'] as const\n\nexport const imageUploadSources = ['album', 'camera'] as const\n\nexport const imageExtensions = [\n  'jpg',\n  'jpeg',\n  'png',\n  'gif',\n  'webp',\n  'ico',\n] as const\n\nexport type ImageUploadCustomFunction = (\n  file: ImageUploadFile\n) => Promise<string> | string\n\nexport type ImageUploadCustomCallbackFunction = (\n  data: UniApp.UploadFileSuccessCallbackResult\n) => Promise<string> | string\n\nexport type ImageBeforeUploadFunction = (\n  file: ImageUploadFile\n) => boolean | Promise<boolean>\n\nexport type ImageBeforeRemoveFunction = (\n  file: ImageUploadListItem\n) => boolean | Promise<boolean>\n\nexport const imageUploadProps = buildProps({\n  /**\n   * @description 已上传的图片列表绑定值，传递的是图片的url地址\n   */\n  modelValue: {\n    type: definePropType<Array<string>>(Array),\n    default: () => [],\n  },\n  /**\n   * @description 禁止上传\n   */\n  disabled: Boolean,\n  /**\n   * @description 图片上传地址\n   */\n  action: String,\n  /**\n   * @description 图片上传的字段名称\n   */\n  name: {\n    type: String,\n    default: 'file',\n  },\n  /**\n   * @description 图片上传的header, header 中不能设置 Referer\n   */\n  header: {\n    type: Object,\n    default: () => ({}),\n  },\n  /**\n   * @description 图片上传HTTP 请求中其他额外的 form data\n   */\n  formData: {\n    type: Object,\n    default: () => ({}),\n  },\n  /**\n   * @description 最大允许上传个数\n   */\n  limit: {\n    type: Number,\n    default: 9,\n  },\n  /**\n   * @description 自动上传\n   */\n  autoUpload: {\n    type: Boolean,\n    default: true,\n  },\n  /**\n   * @description 显示删除按钮\n   */\n  showRemove: {\n    type: Boolean,\n    default: true,\n  },\n  /**\n   * @description 显示错误提示信息\n   */\n  showErrorTips: {\n    type: Boolean,\n    default: true,\n  },\n  /**\n   * @description 显示上传进度条\n   */\n  showUploadProgress: {\n    type: Boolean,\n    default: true,\n  },\n  /**\n   * @description 上传图片的SizeType\n   */\n  sizeType: {\n    type: definePropType<Array<ImageUploadSizeType>>(Array),\n    default: () => ['original', 'compressed'],\n  },\n  /**\n   * @description 上传图片的来源\n   */\n  sourceType: {\n    type: definePropType<Array<ImageUploadSource>>(Array),\n    default: () => ['album', 'camera'],\n  },\n  /**\n   * @description 允许多选图片\n   */\n  multiple: {\n    type: Boolean,\n    default: true,\n  },\n  /**\n   * @description 允许上传的最大图片大小，单位为byte\n   */\n  maxSize: {\n    type: Number,\n    default: 10 * 1024 * 1024,\n  },\n  /**\n   * @description 允许上传的图片类型\n   */\n  extensions: {\n    type: definePropType<Array<string>>(Array),\n    default: () => imageExtensions,\n  },\n  /**\n   * @description 自动移除上传失败的图片\n   */\n  autoRemoveFaildFile: {\n    type: Boolean,\n    default: false,\n  },\n  /**\n   * @description 自定义上传函数\n   */\n  customUploadHandler: {\n    type: definePropType<ImageUploadCustomFunction>(Function),\n  },\n  /**\n   * @description 自定义上传回调处理函数\n   */\n  customUploadCallback: {\n    type: definePropType<ImageUploadCustomCallbackFunction>(Function),\n  },\n  /**\n   * @description 上传前的钩子函数\n   */\n  beforeUpload: {\n    type: definePropType<ImageBeforeUploadFunction>(Function),\n  },\n  /**\n   * @description 删除前的钩子函数\n   */\n  beforeRemove: {\n    type: definePropType<ImageBeforeRemoveFunction>(Function),\n  },\n  /**\n   * @description 值发生修改时是否触发表单验证\n   */\n  validateEvent: {\n    type: Boolean,\n    default: true,\n  },\n})\n\n/* eslint-disable @typescript-eslint/no-unused-vars */\nexport const imageUploadEmits = {\n  [UPDATE_MODEL_EVENT]: (value: Array<string>) => isArray(value),\n  [CHANGE_EVENT]: (value: Array<string>) => isArray(value),\n  /**\n   * @description 图片超过最大尺寸或者文件不支持时触发\n   */\n  oversizeOrNoSupport: (file: Array<ImageUploadFile>) => true,\n  /**\n   * @description 图片上传成功回调\n   */\n  success: (file: ImageUploadListItem) => true,\n  /**\n   * @description 图片上传失败回调\n   */\n  fail: (error: Error, file: ImageUploadListItem) => true,\n  /**\n   * @description 图片删除成功回调\n   */\n  remove: (url: string) => true,\n  /**\n   * @description 图片预览回调\n   */\n  preview: (url: string) => true,\n}\n/* eslint-enable @typescript-eslint/no-unused-vars */\n\nexport type ImageUploadProps = ExtractPropTypes<typeof imageUploadProps>\nexport type ImageUploadEmits = typeof imageUploadEmits\n\nexport type ImageUploadSizeType = (typeof imageUploadSizeTypes)[number]\nexport type ImageUploadSource = (typeof imageUploadSources)[number]\nexport type ImageExtension = (typeof imageExtensions)[number]\n","<script lang=\"ts\" setup>\nimport TnIcon from '../../icon/src/icon.vue'\nimport { useNamespace } from '../../../hooks'\nimport { imageUploadEmits, imageUploadProps } from './image-upload'\nimport { useImageUpload } from './composables'\n\nconst props = defineProps(imageUploadProps)\ndefineEmits(imageUploadEmits)\n\nconst ns = useNamespace('image-upload')\nconst nsItem = useNamespace('image-upload-item')\n\nconst {\n  fileList,\n  isExceedMaxCount,\n  chooseFile,\n  retryUploadFile,\n  retryAllUpload,\n  customUploadHandle,\n  removeFileEvent,\n  clearAllFile,\n  previewImage,\n} = useImageUpload(props)\n\ndefineExpose({\n  /**\n   * @description 手动选择文件\n   */\n  chooseFile,\n  /**\n   * @description 手动上传图片\n   */\n  upload: customUploadHandle,\n  /**\n   * @description 重新上传失败的文件\n   */\n  retry: retryAllUpload,\n  /**\n   * @description 清空所有文件\n   */\n  clear: clearAllFile,\n})\n</script>\n\n<template>\n  <view :class=\"[ns.b()]\">\n    <!-- 上传列表 -->\n    <view\n      v-for=\"(item, index) in fileList\"\n      :key=\"index\"\n      :class=\"[nsItem.b(), nsItem.is('custom', !!$slots.uploadImage)]\"\n    >\n      <slot name=\"uploadImage\" :data=\"item\">\n        <!-- 已上传图片 -->\n        <view\n          class=\"tn-gray-light_bg\"\n          :class=\"[\n            nsItem.e('image'),\n            nsItem.is('finish', item.status === 'done'),\n          ]\"\n          @tap.stop=\"previewImage(index)\"\n        >\n          <image class=\"image\" :src=\"item.url\" mode=\"aspectFill\" />\n        </view>\n        <!-- 删除按钮 -->\n        <view\n          v-if=\"showRemove && !disabled\"\n          :class=\"[nsItem.e('remove')]\"\n          @tap.stop=\"removeFileEvent(index)\"\n        >\n          <view :class=\"[nsItem.em('remove', 'icon')]\">\n            <TnIcon name=\"close-fill\" />\n          </view>\n        </view>\n        <!-- 重试蒙层 -->\n        <view\n          v-if=\"item.status === 'failed' && !disabled\"\n          :class=\"[nsItem.e('retry')]\"\n          @tap.stop=\"retryUploadFile(index)\"\n        >\n          <TnIcon name=\"refresh-simple\" />\n        </view>\n        <!-- 进度波浪 -->\n        <!-- 进度0 ~ 100 => -300 ~ -400 -->\n        <view\n          v-if=\"\n            showUploadProgress &&\n            item.progress > 0 &&\n            item.progress < 100 &&\n            !disabled\n          \"\n          :class=\"[\n            nsItem.e('progress'),\n            nsItem.is('finish', item.progress === 100),\n          ]\"\n        >\n          <view\n            :class=\"[nsItem.em('progress', 'wave')]\"\n            :style=\"{ top: `${-300 - item.progress}%` }\"\n          />\n          <view\n            :class=\"[nsItem.em('progress', 'wave')]\"\n            :style=\"{ top: `${-300 - item.progress}%` }\"\n          />\n        </view>\n      </slot>\n    </view>\n    <!-- 上传按钮 -->\n    <template v-if=\"!isExceedMaxCount && !disabled\">\n      <slot name=\"uploadBtn\">\n        <view\n          class=\"tn-gray-light_bg tn-gray-disabled_text\"\n          :class=\"[nsItem.b()]\"\n          @tap.stop=\"chooseFile\"\n        >\n          <view :class=\"[nsItem.e('add-btn')]\">\n            <slot name=\"addBtn\">\n              <view :class=\"[nsItem.em('add-btn', 'icon')]\">\n                <TnIcon name=\"add-fill\" />\n              </view>\n            </slot>\n          </view>\n        </view>\n      </slot>\n    </template>\n  </view>\n</template>\n\n<style lang=\"scss\" scoped>\n@import '../../../theme-chalk/src/image-upload.scss';\n</style>\n","import Component from '/Users/zhizhi/Documents/HBuilderProjects/dnf/uni_modules/tuniaoui-vue3/components/image-upload/src/image-upload.vue'\nwx.createComponent(Component)"],"names":["buildProps","definePropType","UPDATE_MODEL_EVENT","isArray","CHANGE_EVENT","useNamespace","useImageUpload"],"mappings":"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"}