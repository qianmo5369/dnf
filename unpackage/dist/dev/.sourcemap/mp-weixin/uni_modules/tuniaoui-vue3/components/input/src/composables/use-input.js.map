{"version":3,"file":"use-input.js","sources":["uni_modules/tuniaoui-vue3/components/input/src/composables/use-input.ts"],"sourcesContent":["import { computed, nextTick, ref, watch } from 'vue'\nimport { trim } from '../../../../libs/lodash'\nimport {\n  CHANGE_EVENT,\n  INPUT_EVENT,\n  UPDATE_MODEL_EVENT,\n} from '../../../../constants'\nimport {\n  FormValidateIconsMap,\n  debugWarn,\n  isEmptyVariableInDefault,\n} from '../../../../utils'\nimport { useToggle } from '../../../../hooks'\nimport { useFormDisabled, useFormItem } from '../../../form'\n\nimport type { SetupContext } from 'vue'\nimport type { FormItemValidateStates } from '../../../form'\nimport type { InputEmit, InputProps } from '../input'\n\nexport const useInput = (\n  props: InputProps,\n  emits: SetupContext<InputEmit>['emit']\n) => {\n  const { form, formItem } = useFormItem()\n\n  // 输入框内容\n  const inputText = ref<string>(\n    String(isEmptyVariableInDefault(props.modelValue, ''))\n  )\n  watch(\n    () => props.modelValue,\n    (val) => {\n      inputText.value = String(isEmptyVariableInDefault(val, ''))\n      if (props.validateEvent) {\n        formItem?.validate?.('change').catch((err) => {\n          debugWarn(err)\n        })\n      }\n    }\n  )\n\n  // 显示/隐藏密码状态\n  const [passwordVisible, togglePasswordVisible] = useToggle(false)\n\n  // 是否显示状态图标\n  const needStatusIcon = computed(() =>\n    isEmptyVariableInDefault(form?.statusIcon, false)\n  )\n  // 校验状态\n  const validateState = computed(() =>\n    isEmptyVariableInDefault<FormItemValidateStates>(\n      formItem?.validateState,\n      ''\n    )\n  )\n  // 校验状态图标\n  const validateIcon = computed(\n    () => validateState.value && FormValidateIconsMap[validateState.value]\n  )\n\n  // 密码显示密码图标\n  const passwordIcon = computed(() =>\n    passwordVisible.value ? 'eye-hide' : 'eye'\n  )\n\n  // 是否显示图标\n  const showIcon = computed(() => {\n    let status = false\n    if (validateState.value && needStatusIcon.value && validateIcon.value)\n      status = true\n    if (props.showPassword) status = true\n    if (props.rightIcon) status = true\n    if (props.clearable) status = true\n    return status\n  })\n\n  // 输入框禁止事件\n  const disabled = useFormDisabled(props.disabled)\n\n  // 是否显示字数统计\n  const showWordLimit = computed<boolean>(\n    () =>\n      props.type === 'textarea' && !!props?.maxlength && !!props?.showWordLimit\n  )\n  // 当前的字数\n  const currentWordCount = computed<number>(() => {\n    if (props.showWordLimit && props.type === 'textarea') {\n      return inputText.value?.length || 0\n    }\n    return 0\n  })\n\n  // 内容输入触发事件\n  const inputInputEvent = (event: any) => {\n    const { value } = event.detail\n    _updateInputText(value)\n  }\n\n  // 输入框聚焦事件\n  const inputFocusEvent = (event: any) => {\n    emits('focus', event)\n  }\n\n  // 输入框失去焦点事件\n  const inputBlurEvent = (event: any) => {\n    emits('blur', event)\n    if (props.validateEvent) {\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      formItem?.validate?.('blur').catch((err) => {\n        debugWarn(err)\n      })\n    }\n  }\n\n  // 点击完成时触发事件\n  const confirmEvent = (event: any) => {\n    const { value } = event.detail\n    emits('confirm', _formatInputText(value))\n  }\n\n  // 点击清除按钮\n  const clearClickEvent = () => {\n    if (disabled.value) return\n    _updateInputText('')\n    emits('clear')\n  }\n\n  // 更新输入框内容\n  const _updateInputText = (value: string) => {\n    value = props.trim ? trim(value) : value\n    // inputText.value = value\n    emits(UPDATE_MODEL_EVENT, _formatInputText(value))\n    nextTick(() => {\n      emits(INPUT_EVENT, _formatInputText(value))\n      emits(CHANGE_EVENT, _formatInputText(value))\n    })\n  }\n\n  // 输入框点击事件\n  const inputClickEvent = () => {\n    if (props.type === 'select') {\n      emits('click')\n    }\n  }\n\n  const _formatInputText = (value: string) => {\n    if (value === '') return ''\n    if (props.type === 'number' || props.type === 'digit')\n      return Number.parseFloat(value)\n    return value\n  }\n\n  return {\n    inputText,\n    needStatusIcon,\n    validateState,\n    validateIcon,\n    passwordVisible,\n    passwordIcon,\n    showIcon,\n    disabled,\n    showWordLimit,\n    currentWordCount,\n    togglePasswordVisible,\n    inputInputEvent,\n    inputFocusEvent,\n    inputBlurEvent,\n    clearClickEvent,\n    confirmEvent,\n    inputClickEvent,\n  }\n}\n"],"names":["useFormItem","ref","isEmptyVariableInDefault","watch","debugWarn","useToggle","computed","FormValidateIconsMap","useFormDisabled","trim","UPDATE_MODEL_EVENT","nextTick","INPUT_EVENT","CHANGE_EVENT"],"mappings":"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"}