{"version":3,"file":"login.js","sources":["pages/login/login.vue","pages/login/login.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"login-page\">\r\n\t\t<view class=\"login-box\">\n\t\t\t\n\t\t\t<!-- #ifdef APP-PLUS -->\n\t\t\t\t\t<text class=\"login-title\">欢迎登录</text>\n\t\t\t\t\t<input class=\"input\" v-model=\"phone\" placeholder=\"请输入账号\" />\n\t\t\t\t\t<view v-if=\"loginType === 'account'\">\n\t\t\t\t\t\t<input class=\"input\" v-model=\"password\" placeholder=\"请输入密码\" password />\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<view v-else>\n\t\t\t\t\t\t<view class=\"input-wrapper\">\n\t\t\t\t\t\t\t<input class=\"input full\" placeholder=\"请输入验证码\" />\n\t\t\t\t\t\t\t<text class=\"send-code-text\" :class=\"{ disabled: countdown > 0 }\" @click=\"sendCode\">\n\t\t\t\t\t\t\t\t{{ countdown > 0 ? countdown + 's后重试' : '发送验证码' }}\n\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<button class=\"login-btn\" @click=\"handleLogin\">登录</button>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t<view class=\"login-switch\">\n\t\t\t\t\t\t<text :class=\"{ active: loginType === 'account' }\" v-if=\"loginType === 'account'\"\n\t\t\t\t\t\t\t@click=\"loginType = 'code'\">验证码登录</text>\n\t\t\t\t\t\t<text :class=\"{ active: loginType === 'code' }\" v-else @click=\"loginType = 'account'\">账号密码登录</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t<!-- #endif -->\n\t\t\t\n\t\t\t\n\t\t\t<!-- #ifdef MP-WEIXIN -->\n\t\t\t\t\t<view class=\"login-logo\">\n\t\t\t\t\t\t<image src=\"https://dnf.hanyunkeji.cn/static/wechat_login.png\" class=\"login-logo-icon\" />\n\t\t\t\t\t</view>\n\t\t\t\t\t<button class=\"login-btn login-btn-wx\" @click=\"mpLogin\">微信一键登录</button>\n\t\t\t<!-- #endif -->\n\t\t\t\r\n\t\t\t\r\n\t\t\t<view class=\"agreement-check\">\r\n\t\t\t\t<radio :checked=\"isChecked\" style=\"transform: scale(.7);\" @click=\"isChecked = !isChecked\"></radio>\r\n\t\t\t\t<!-- <checkbox :checked=\"isChecked\" @click=\"isChecked = !isChecked\" class=\"checkbox\" /> -->\r\n\t\t\t\t<view class=\"agreement-text\">\r\n\t\t\t\t\t登录即代表您已同意 <text class=\"link\">《用户协议》</text> 和 <text class=\"link\">《隐私政策》</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- #ifdef APP-PLUS -->\n\t\t\t\t<view class=\"wechat-login\" @click=\"mpLogin\">\n\t\t\t\t\t<image src=\"https://dnf.hanyunkeji.cn/static/wechat_login.png\" class=\"wechat-icon\" />\n\t\t\t\t\t<text class=\"wechat-text\">微信一键登录</text>\n\t\t\t\t</view>\n\t\t\t<!-- #endif -->\n\t\t\t\t\n\t\t\t\r\n\r\n\t\t\t\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\n\t\tonMounted\r\n\t} from 'vue'\r\n\t// import { showToast } from '@dcloudio/uni-ui'\r\n\timport {\r\n\t\tuseUserStore\r\n\t} from '@/stores/user'\r\n\tconst loginType = ref('account')\r\n\tconst countdown = ref(0)\r\n\tconst isChecked = ref(true)\r\n\tconst phone = ref('')\r\n\tconst password = ref('')\r\n\tconst code = ref('')\r\n\tlet timer = null;\n\tconst isWxMiniProgram = ref(false)\n\t\n\t\n\t// 判断是否是微信小程序\n\tonMounted(() => {\n\t\n\t})\r\n\r\n\tconst sendCode = async () => {\r\n\t\tif (countdown.value > 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!phone.value) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请输入手机号',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst res = await uni.$http.post('/sms/send', {\r\n\t\t\tmobile: phone.value,\r\n\t\t\tevent: 'mobilelogin'\r\n\t\t})\r\n\r\n\t\tif (res.code === 1) {\r\n\t\t\tcountdown.value = 60;\r\n\t\t\t// timer = setInterval(() => {\r\n\t\t\t// \tcountdown.value--\r\n\t\t\t// \tif (countdown.value <= 0) clearInterval(timer)\r\n\t\t\t// }, 1000)\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tconst handleLogin = async () => {\r\n\t\tif (!isChecked.value) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请先勾选同意协议',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (!phone.value) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请输入手机号',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (loginType.value === 'code') {\r\n\t\t\tif (!code.value) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请输入验证码',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (!password.value) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请输入密码',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (loginType.value == 'code') {\r\n\t\t\tvar res = await uni.$http.post('/user/mobilelogin', {\r\n\t\t\t\tmobile: phone.value,\r\n\t\t\t\tcaptcha: code.value,\n\t\t\t\tshare_uid: uni.getStorageSync('share_uid')\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tvar res = await uni.$http.post('/user/login', {\r\n\t\t\t\taccount: phone.value,\r\n\t\t\t\tpassword: password.value,\n\t\t\t\tshare_uid: uni.getStorageSync('share_uid')\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tif (res.code === 1) {\r\n\t\t\tuni.setStorageSync('token', res.data.userinfo.token);\r\n\r\n\t\t\tconst token = res.data.userinfo.token\r\n\t\t\tconst userStore = useUserStore()\r\n\t\t\tuserStore.setToken(token)\r\n\t\t\tawait userStore.fetchUserInfo()\r\n\t\t\tuni.reLaunch({\r\n\t\t\t\turl: '/pages/index/index'\r\n\t\t\t})\r\n\r\n\t\t\t// uni.showToast({\r\n\t\t\t// \ttitle: res.msg,\r\n\t\t\t// \ticon: 'none'\r\n\t\t\t// })\r\n\t\t\tuni.reLaunch({\r\n\t\t\t\turl: '/pages/index/index'\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\n\t\n\t\n\tconst mpLogin =  () => {\n\t\tuni.login({\n\t\t\tsuccess:  async (loginRes) => {\n\t\t\t\tconst res = await uni.$http.post('/user/wechatLogin', {\n\t\t\t\t\t'code': loginRes.code,\n\t\t\t\t\t'anonymousCode': loginRes.anonymousCode,\n\t\t\t\t})\n\t\n\t\n\t\t\t\tif (res.code === 1) {\n\t\t\t\t\tuni.setStorageSync('token', res.data.userinfo.token);\n\t\n\t\t\t\t\tconst token = res.data.userinfo.token\n\t\t\t\t\tconst userStore = useUserStore()\n\t\t\t\t\tuserStore.setToken(token)\n\t\t\t\t\tawait userStore.fetchUserInfo()\n\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\turl: '/pages/index/index'\n\t\t\t\t\t})\n\t\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: res.msg,\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\turl: '/pages/index/index'\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: res.msg,\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t.login-page {\r\n\t\tbackground: #ffffff;\r\n\t\tpadding: 120rpx 40rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.login-box {\r\n\t\twidth: 100%;\r\n\t\tmax-width: 640rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 24rpx;\r\n\t\tpadding: 60rpx 0rpx;\r\n\t\t/* box-shadow: 0 8rpx 20rpx rgba(0, 0, 0, 0.05); */\r\n\t}\r\n\r\n\t.login-title {\r\n\t\tfont-size: 40rpx;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-bottom: 50rpx;\r\n\t\tcolor: #222;\r\n\t\ttext-align: left;\r\n\t\tmargin-top: 120rpx;\r\n\r\n\t}\r\n\r\n\t.input {\r\n\t\twidth: 100%;\r\n\t\tbackground: #f5f7fa;\r\n\t\theight: 90rpx;\r\n\t\tborder-radius: 60rpx;\r\n\t\tpadding: 20rpx 24rpx;\r\n\t\tfont-size: 26rpx;\r\n\t\tmargin-bottom: 50rpx;\r\n\t}\r\n\r\n\t.input-wrapper {\r\n\t\tposition: relative;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\r\n\t.input.full {\r\n\t\twidth: 100%;\r\n\t\tpadding-right: 160rpx;\r\n\t}\r\n\r\n\t.send-code-text {\r\n\t\tposition: absolute;\r\n\t\tright: 24rpx;\r\n\t\ttop: 50%;\r\n\t\ttransform: translateY(-50%);\r\n\t\tcolor: #1677ff;\r\n\t\tfont-size: 24rpx;\r\n\t}\r\n\r\n\t.send-code-text.disabled {\r\n\t\tcolor: #ccc;\r\n\t}\r\n\r\n\t.login-btn {\r\n\t\twidth: 100%;\r\n\t\tbackground: #1677ff;\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 28rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t\tpadding: 5rpx 0;\r\n\t\tmargin-top: 70rpx;\r\n\t\tmargin-bottom: 12rpx;\r\n\t}\n\t\n\t.login-logo{\n\t\ttext-align: center;\n\t\tmargin-top: 300rpx;\n\t}\n\t.login-logo-icon{\n\t\twidth: 300rpx;\n\t\theight: 300rpx;\n\t}\n\t.login-btn-wx{\n\t\tbackground: #07ba05;\n\t\tmargin-bottom: 30rpx;\n\t}\r\n\r\n\t.login-switch {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tmargin: 30rpx 0;\r\n\t\tfont-size: 26rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.login-switch .active {\r\n\t\tcolor: #1677ff;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.divider {\r\n\t\tmargin: 0 16rpx;\r\n\t\tcolor: #ccc;\r\n\t}\r\n\r\n\t.agreement-check {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tfont-size: 22rpx;\r\n\t\tcolor: #999;\r\n\t\tmargin-bottom: 40rpx;\r\n\t\ttext-align: center;\r\n\t\tgap: 12rpx;\r\n\t}\r\n\r\n\t.checkbox {\r\n\t\ttransform: scale(0.8);\r\n\t\tborder-radius: 50%;\r\n\t\tbackground-color: #fff;\r\n\t\tborder: 2rpx solid #ccc;\r\n\t\twidth: 32rpx;\r\n\t\theight: 32rpx;\r\n\t}\r\n\r\n\t.link {\r\n\t\tcolor: #1677ff;\r\n\t}\r\n\r\n\t.wechat-login {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tmargin-top: 20rpx;\r\n\t}\r\n\r\n\t.wechat-icon {\r\n\t\twidth: 72rpx;\r\n\t\theight: 72rpx;\r\n\t\tmargin-bottom: 8rpx;\r\n\t}\r\n\r\n\t.wechat-text {\r\n\t\tfont-size: 22rpx;\r\n\t\tcolor: #888;\r\n\t}\r\n</style>","import MiniProgramPage from '/Users/zhizhi/Documents/HBuilderProjects/dnf/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","useUserStore"],"mappings":";;;;;;AAuEmBA,kBAAAA,IAAI,SAAS;AACbA,kBAAAA,IAAI,CAAC;AACvB,UAAM,YAAYA,cAAG,IAAC,IAAI;AACZA,kBAAAA,IAAI,EAAE;AACHA,kBAAAA,IAAI,EAAE;AACVA,kBAAAA,IAAI,EAAE;AAEKA,kBAAAA,IAAI,KAAK;AAIjCC,kBAAAA,UAAU,MAAM;AAAA,IAEjB,CAAE;AAkHD,UAAM,UAAW,MAAM;AACtBC,oBAAAA,MAAI,MAAM;AAAA,QACT,SAAU,OAAO,aAAa;AAC7B,gBAAM,MAAM,MAAMA,cAAAA,MAAI,MAAM,KAAK,qBAAqB;AAAA,YACrD,QAAQ,SAAS;AAAA,YACjB,iBAAiB,SAAS;AAAA,UAC/B,CAAK;AAGD,cAAI,IAAI,SAAS,GAAG;AACnBA,0BAAG,MAAC,eAAe,SAAS,IAAI,KAAK,SAAS,KAAK;AAEnD,kBAAM,QAAQ,IAAI,KAAK,SAAS;AAChC,kBAAM,YAAYC,YAAAA,aAAc;AAChC,sBAAU,SAAS,KAAK;AACxB,kBAAM,UAAU,cAAe;AAC/BD,0BAAAA,MAAI,SAAS;AAAA,cACZ,KAAK;AAAA,YACX,CAAM;AAEDA,0BAAAA,MAAI,UAAU;AAAA,cACb,OAAO,IAAI;AAAA,cACX,MAAM;AAAA,YACZ,CAAM;AACDA,0BAAAA,MAAI,SAAS;AAAA,cACZ,KAAK;AAAA,YACX,CAAM;AAAA,UACN,OAAW;AACNA,0BAAAA,MAAI,UAAU;AAAA,cACb,OAAO,IAAI;AAAA,cACX,MAAM;AAAA,YACZ,CAAM;AAAA,UACD;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;;;;;;;;;;;ACxOF,GAAG,WAAW,eAAe;"}