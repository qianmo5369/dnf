{"version":3,"file":"send.js","sources":["pages/complaint/send.vue","pages/complaint/send.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"appeal-form-page\">\r\n\t\t<!-- 选择被投诉人 -->\r\n\t\t<view class=\"form-section\">\r\n\t\t\t<text class=\"label required\">被投诉人</text>\r\n\t\t\t<view class=\"role-list\">\r\n\t\t\t\t<view v-for=\"(role,index) in targets\" :key=\"index\" class=\"role-card\" :class=\"{ selected: selectedIds.includes(index) }\"\r\n\t\t\t\t\t  @click=\"selectRole(index)\">\r\n\t\t\t\t\t<tn-avatar :url=\"role.hero_avatar\" size=\"80rpx\" />\r\n\t\t\t\t\t<view class=\"role-info\">\r\n\t\t\t\t\t\t<view class=\"role-value\">{{ role.resist_power }} {{ role.hero_name }}</view>\r\n\t\t\t\t\t\t<view class=\"role-subtitle\">{{role.user_nickname}}</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 输入投诉内容 -->\r\n\t\t<view class=\"form-section\">\r\n\t\t\t<text class=\"label required\">投诉内容</text>\r\n\t\t\t<textarea class=\"textarea\" v-model=\"reason\" placeholder=\"请输入投诉的详细内容\" />\r\n\t\t</view>\r\n\r\n\t\t<!-- 上传截图 -->\r\n\t\t<view class=\"form-section\">\r\n\t\t\t<text class=\"label\">凭证补充</text>\r\n\t\t\t<view class=\"upload-box\">\r\n\t\t\t\t<fui-upload borderColor=\"#eee\" background=\"#Fff\" radius=\"10\" immediate width=\"200\" height=\"200\"\r\n\t\t\t\t\t:url=\"uploadUrl\" :max=\"3                                                                                                                                                                                                                                                                          \" ref=\"uploadRef\" @success=\"uploadSuccess\"\r\n\t\t\t\t\t@error=\"uploadError\"></fui-upload>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 提交按钮 -->\r\n\t\t<view class=\"bottom-btn\">\r\n\t\t\t<view class=\"submit-btn\" @tap=\"submitAppeal\">提交申诉</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\n\t\tonMounted\r\n\t} from 'vue'\r\n\timport {\r\n\t\tbaseUrl\r\n\t} from \"@/util/env\";\r\n\timport {\r\n\t\tonShow,\r\n\t\tonLoad\r\n\t} from '@dcloudio/uni-app';\n\timport fuiUpload from \"@/components/fui-upload.vue\"\r\n\tconst room_id = ref(null)\n\tconst uploadUrl = baseUrl + '/common/upload';\n\tconst selectedIds = ref([])\n\tconst uploadStatus = ref(false);\r\n\tconst reason = ref('')\r\n\tconst imageUrl = ref([])\r\n\tconst targets = ref([])\r\n\tonLoad((params) => {\r\n\t\tif (params.room_id) {\r\n\t\t\troom_id.value = params.room_id;\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: \"房间不存在\",\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t})\n\t\n\tonMounted(() => {\n\t\tgetComplaintTargets()\n\t})\n\t\n\t\r\n\tconst selectRole = (index)=>{\n\t\tif (selectedIds.value.includes(index)) {\n\t\t    selectedIds.value = selectedIds.value.filter(i => i !== index)\n\t\t  } else {\n\t\t    selectedIds.value.push(index)\n\t\t  }\n\t}\r\n\r\n\tconst getComplaintTargets = async () => {\r\n\t\tconst res = await uni.$http.post('/room/getComplaintTargets', {room_id: room_id.value})\r\n\t\tif (res.code === 1) {\r\n\t\t\ttargets.value = res.data;\r\n\t\t}\r\n\t}\r\n\tfunction chooseImage() {\r\n\t\tuni.chooseImage({\r\n\t\t\tcount: 1,\r\n\t\t\tsuccess(res) {\r\n\t\t\t\timageUrl.value = res.tempFilePaths[0]\r\n\t\t\t}\r\n\t\t})\r\n\t}\n\t\n\tconst uploadSuccess = (e) => {\n\t\tconsole.log(e)\n\t\t//上传成功回调，处理服务器返回数据【此处根据实际返回数据进行处理】\n\t\tlet res = JSON.parse(e.res.data.replace(/\\ufeff/g, \"\") || \"{}\")\n\t\tuploadStatus.value = e.status\n\t\tif (res.data.url) {\n\t\t\timageUrl.value.push(res.data.url)\n\t\t}\n\t}\n\t\n\tconst uploadError = (e) => {\n\t\tuploadStatus.value = e.status\n\t\tuni.showModal({\n\t\t\tcontent: JSON.stringify(e)\n\t\t})\n\t}\r\n\r\n\tconst submitAppeal =  async () =>{\n\t\tif (selectedIds.value.length === 0) {\n\t\t    return uni.showToast({ title: '请选择被投诉人', icon: 'none' })\n\t\t  }\r\n\t\tif (!reason.value.trim()) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请填写投诉内容',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\n\t\t\n\t\tconst imagesList = imageUrl.value.join(',')\n\t\tconst res = await uni.$http.post('/room/submitComplaint', {\n\t\t    room_id: room_id.value,\n\t\t    target_ids: selectedIds.value.map(i => targets.value[i].user_id),\n\t\t    reason: reason.value,\n\t\t    images:imagesList\n\t\t  })\n\t\tif (res.code === 1) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '发起申诉成功，请耐心等待',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t\tsetTimeout(()=>{\n\t\t\t\tuni.navigateBack()\n\t\t\t},1500)\n\t\t}\r\n\t}\r\n</script>\r\n<style scoped>\r\n\t.appeal-form-page {\r\n\t\tpadding: 30rpx;\r\n\t\tbackground-color: #fff;\r\n\t\t/* min-height: 100vh; */\r\n\t}\r\n\r\n\t.form-header {\r\n\t\ttext-align: center;\r\n\t\tmargin-bottom: 40rpx;\r\n\t}\r\n\r\n\t.form-title {\r\n\t\tfont-size: 36rpx;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.label {\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #333;\r\n\t\tmargin: 20rpx 0rpx;\r\n\t\tdisplay: block;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\r\n\t.label.required::before {\r\n\t\tcontent: '*';\r\n\t\tcolor: red;\r\n\t\tmargin-right: 6rpx;\r\n\t}\r\n\r\n\t.complain-target {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tbackground: #f5f5f5;\r\n\t\tborder-radius: 12rpx;\r\n\t\tpadding: 20rpx;\r\n\t}\r\n\r\n\t.avatar {\r\n\t\twidth: 80rpx;\r\n\t\theight: 80rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\r\n\t.info .name {\r\n\t\tfont-size: 30rpx;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.info .sub {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.textarea {\r\n\t\twidth: 100%;\r\n\t\theight: 200rpx;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 12rpx;\r\n\t\tpadding: 20rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tborder: 2rpx solid #f7f7f7;\r\n\t}\r\n\r\n\t.upload-box {\r\n\t\t/* background: #f7f7f7; */\r\n\t\tborder-radius: 16rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\n\t\tflex-wrap: wrap;\r\n\t\t/* justify-content: center; */\r\n\t}\r\n\r\n\t.upload-placeholder {\r\n\t\tfont-size: 60rpx;\r\n\t\tcolor: #ccc;\r\n\t}\r\n\r\n\t.preview {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tborder-radius: 12rpx;\r\n\t}\r\n\r\n\t.bottom-btn {\r\n\t\tmargin-top: 80rpx;\r\n\t}\r\n\r\n\t.submit-btn {\r\n\t\tbackground: #007aff;\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 28rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t\tpadding: 25rpx 0;\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t.role-list {\r\n\t\tdisplay: grid;\r\n\t\tgrid-template-columns: repeat(2, 1fr);\r\n\t\tgrid-gap: 20rpx;\r\n\t\t/* padding: 30rpx; */\r\n\t\tmargin-top: 30rpx;\r\n\t}\r\n\r\n\t/* 单个角色卡片 */\r\n\t.role-card {\r\n\t\tposition: relative;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 16rpx;\r\n\t\tpadding: 20rpx;\r\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n\t\toverflow: hidden;\n\t\tborder: 2rpx solid transparent;\r\n\t}\r\n\r\n\t/* 三角形背景——尖朝左下，位于右上角 */\r\n\t.card-active::before {\r\n\t\tcontent: \"\";\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tright: 0;\r\n\t\twidth: 90rpx;\r\n\t\t/* 三角边长 */\r\n\t\theight: 60rpx;\r\n\t\tbackground-color: #409eff;\r\n\t\tclip-path: polygon(100% 0%,\r\n\t\t\t\t/* 顶点：右上 */\r\n\t\t\t\t100% 100%,\r\n\t\t\t\t/* 底点：右下 */\r\n\t\t\t\t0% 0%\r\n\t\t\t\t/* 左顶点：左上 */\r\n\t\t\t);\r\n\t}\r\n\r\n\t/* 对勾 */\r\n\t.card-active::after {\r\n\t\tcontent: \"当前\";\r\n\t\tposition: absolute;\r\n\t\ttop: 4rpx;\r\n\t\tright: 4rpx;\r\n\t\tfont-size: 20rpx;\r\n\t\t/* line-height: 50rpx; */\r\n\t\tcolor: #fff;\r\n\t\t/* line-height: 2; */\r\n\t}\r\n\r\n\t/* 文字区域 */\r\n\t.role-info {\r\n\t\tmargin-left: 20rpx;\r\n\t}\r\n\r\n\t.role-value {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.role-subtitle {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #888;\r\n\t\tmargin-top: 8rpx;\r\n\t}\n\t\n\t.selected {\n\t  border: 2rpx solid #2e89ff;\n\t  background: #e6f0ff;\n\t}\r\n</style>","import MiniProgramPage from '/Users/zhizhi/Documents/HBuilderProjects/dnf/pages/complaint/send.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","baseUrl","onLoad","uni","onMounted"],"mappings":";;;;;;;;;;;AAqDC,MAAM,YAAY,MAAW;;;;AAC7B,UAAM,UAAUA,cAAG,IAAC,IAAI;AACxB,UAAM,YAAYC,SAAO,UAAG;AAC5B,UAAM,cAAcD,cAAG,IAAC,EAAE;AAC1B,UAAM,eAAeA,kBAAI,KAAK;AAC9B,UAAM,SAASA,cAAG,IAAC,EAAE;AACrB,UAAM,WAAWA,cAAG,IAAC,EAAE;AACvB,UAAM,UAAUA,cAAG,IAAC,EAAE;AACtBE,kBAAM,OAAC,CAAC,WAAW;AAClB,UAAI,OAAO,SAAS;AACnB,gBAAQ,QAAQ,OAAO;AAAA,MAC1B,OAAS;AACNC,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAI;AAAA,MACD;AAAA,IACH,CAAE;AAEDC,kBAAAA,UAAU,MAAM;AACf,0BAAqB;AAAA,IACvB,CAAE;AAGD,UAAM,aAAa,CAAC,UAAQ;AAC3B,UAAI,YAAY,MAAM,SAAS,KAAK,GAAG;AACnC,oBAAY,QAAQ,YAAY,MAAM,OAAO,OAAK,MAAM,KAAK;AAAA,MACnE,OAAW;AACL,oBAAY,MAAM,KAAK,KAAK;AAAA,MAC7B;AAAA,IACH;AAED,UAAM,sBAAsB,YAAY;AACvC,YAAM,MAAM,MAAMD,cAAG,MAAC,MAAM,KAAK,6BAA6B,EAAC,SAAS,QAAQ,MAAK,CAAC;AACtF,UAAI,IAAI,SAAS,GAAG;AACnB,gBAAQ,QAAQ,IAAI;AAAA,MACpB;AAAA,IACD;AAUD,UAAM,gBAAgB,CAAC,MAAM;AAC5BA,oBAAAA,MAAY,MAAA,OAAA,mCAAA,CAAC;AAEb,UAAI,MAAM,KAAK,MAAM,EAAE,IAAI,KAAK,QAAQ,WAAW,EAAE,KAAK,IAAI;AAC9D,mBAAa,QAAQ,EAAE;AACvB,UAAI,IAAI,KAAK,KAAK;AACjB,iBAAS,MAAM,KAAK,IAAI,KAAK,GAAG;AAAA,MAChC;AAAA,IACD;AAED,UAAM,cAAc,CAAC,MAAM;AAC1B,mBAAa,QAAQ,EAAE;AACvBA,oBAAAA,MAAI,UAAU;AAAA,QACb,SAAS,KAAK,UAAU,CAAC;AAAA,MAC5B,CAAG;AAAA,IACD;AAED,UAAM,eAAgB,YAAW;AAChC,UAAI,YAAY,MAAM,WAAW,GAAG;AAChC,eAAOA,cAAAA,MAAI,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAAA,MACxD;AACH,UAAI,CAAC,OAAO,MAAM,QAAQ;AACzB,eAAOA,cAAAA,MAAI,UAAU;AAAA,UACpB,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAI;AAAA,MACD;AAED,YAAM,aAAa,SAAS,MAAM,KAAK,GAAG;AAC1C,YAAM,MAAM,MAAMA,cAAAA,MAAI,MAAM,KAAK,yBAAyB;AAAA,QACtD,SAAS,QAAQ;AAAA,QACjB,YAAY,YAAY,MAAM,IAAI,OAAK,QAAQ,MAAM,CAAC,EAAE,OAAO;AAAA,QAC/D,QAAQ,OAAO;AAAA,QACf,QAAO;AAAA,MACb,CAAK;AACH,UAAI,IAAI,SAAS,GAAG;AACnBA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACV,CAAI;AACD,mBAAW,MAAI;AACdA,wBAAAA,MAAI,aAAc;AAAA,QAClB,GAAC,IAAI;AAAA,MACN;AAAA,IACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/IF,GAAG,WAAW,eAAe;"}