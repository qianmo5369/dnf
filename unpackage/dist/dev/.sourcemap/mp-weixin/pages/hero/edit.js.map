{"version":3,"file":"edit.js","sources":["pages/hero/edit.vue","pages/hero/edit.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"page-container\">\r\n\r\n\t\t<fui-bottom-popup :show=\"showRoleSelect\">\r\n\r\n\t\t\t<view class=\"role-select-popup\">\r\n\t\t\t\t<view class=\"popup-header\">选择角色</view>\r\n\t\t\t\t<view class=\"fui-icon__close\" @tap=\"showRoleSelect = false\">\r\n\t\t\t\t\t<TnIcon name=\"close\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<scroll-view scroll-y class=\"role-group-scroll\">\r\n\t\t\t\t\t<view v-for=\"group in heroList\" :key=\"group.category\" class=\"role-group\">\r\n\t\t\t\t\t\t<text class=\"group-title\">{{ group.name }}</text>\r\n\t\t\t\t\t\t<view class=\"role-list\">\r\n\t\t\t\t\t\t\t<view class=\"role-item\" v-for=\"role in group.heroes\" :key=\"role.id\"\r\n\t\t\t\t\t\t\t\t@click=\"selectRole(role)\">\r\n\t\t\t\t\t\t\t\t<image class=\"role-avatar\" :src=\"role.avatar\" />\r\n\t\t\t\t\t\t\t\t<text class=\"role-name\">{{ role.name }}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</scroll-view>\r\n\t\t\t</view>\r\n\t\t</fui-bottom-popup>\r\n\t\t<view class=\"form\">\n\t\t\t\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">角色职业<text class=\"required\">*</text></text>\r\n\t\t\t\t<view class=\"input-select\" @click=\"showRoleSelect = true\">\r\n\t\t\t\t\t<image v-if=\"selectedRole.avatar\" class=\"form-avatar\" :src=\"selectedRole.avatar\" />\r\n\t\t\t\t\t<text>{{ selectedRole.name || '请选择职业' }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">角色昵称<text class=\"required\">*</text></text>\r\n\t\t\t\t<input class=\"input\" v-model=\"roleName\" placeholder=\"请输入昵称\" />\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"form-item\">\r\n\t\t\t\t<text class=\"label\">抗魔值 (万)<text class=\"required\">*</text></text>\r\n\t\t\t\t<input class=\"input\" type=\"number\" v-model=\"resist\" placeholder=\"抗魔值 比如3.2(单位万)\"\r\n\t\t\t\t\t@input=\"onResistInput\" />\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"button-group\">\r\n\t\t\t\t<button class=\"save-btn\" @click=\"saveRole\">保存</button>\r\n\t\t\t\t<button v-if=\"isEdit\" class=\"delete-btn\" @click=\"deleteRole\">删除</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tonMounted\r\n\t} from 'vue'\r\n\timport {\r\n\t\tonLoad\r\n\t} from '@dcloudio/uni-app';\r\n\timport fuiBottomPopup from \"@/components/fui-bottom-popup.vue\"\r\n\timport TnIcon from '@/uni_modules/tuniaoui-vue3/components/icon/src/icon.vue'\r\n\timport Roles from '@/components/Roles.vue';\r\n\r\n\tconst showRoleSelect = ref(false)\r\n\tconst roleName = ref('')\r\n\tconst resist = ref('')\r\n\tconst selectedRole = ref({})\r\n\tconst isEdit = ref(false)\r\n\tconst userHero = ref({})\r\n\tconst id = ref(null)\r\n\r\n\r\n\tconst selectRole = (item) => {\r\n\t\tselectedRole.value = item\r\n\t\t// roleName.value = item.name;\r\n\t\tshowRoleSelect.value = false\r\n\t}\r\n\r\n\tconst saveRole = async () => {\r\n\t\tconst value = parseFloat(resist.value)\r\n\t\tif (!selectedRole.value.name || !roleName.value || !resist.value) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请填写完整信息',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (isNaN(value) || value > 999) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '抗魔值不能大于999',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t\t// console.log('保存', selectedRole.value, roleName.value, resist_power)\r\n\r\n\t\tconst res = await uni.$http.post('/dungeon/saveUserHero', {\r\n\t\t\tid: id.value,\r\n\t\t\thero_id: selectedRole.value.id,\r\n\t\t\tnickname: roleName.value,\r\n\t\t\tresist_power: resist.value\r\n\t\t})\r\n\r\n\t\tif (res.code === 1) {\r\n\t\t\t// heroList.value = res.data;\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\n\t\t\t\n\t\t\tsetTimeout(()=>{\n\t\t\t\tuni.navigateBack()\n\t\t\t},1500)\n\t\t\t\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tconst deleteRole = () => {\r\n\t\tconsole.log('删除角色')\r\n\t}\r\n\r\n\tconst onResistInput = (e) => {\r\n\t\tlet val = e.detail.value\r\n\t\tif (parseFloat(val) > 999) {\r\n\t\t\tresist.value = '999';\r\n\t\t\t// return false;\r\n\t\t\t// uni.showToast({ title: '抗魔值不能大于999', icon: 'none' })\r\n\t\t} else {\r\n\t\t\tresist.value = val\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\tonLoad((params) => {\r\n\t\tif (params.id) {\r\n\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\ttitle: '编辑角色'\r\n\t\t\t})\r\n\t\t\tisEdit.value = true;\r\n\t\t\tid.value = params.id;\r\n\t\t\tgetUserHero(params.id)\r\n\t\t} else {\r\n\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\ttitle: '新增角色'\r\n\t\t\t})\r\n\t\t}\r\n\t})\r\n\r\n\r\n\tconst heroList = ref([])\r\n\r\n\tconst getHeroList = async () => {\r\n\r\n\t\tconst res = await uni.$http.get('/dungeon/heroList')\r\n\r\n\t\tif (res.code === 1) {\r\n\t\t\theroList.value = res.data;\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tconst getUserHero = async (id) => {\r\n\r\n\t\tconst res = await uni.$http.post('/dungeon/getUserHero', {\r\n\t\t\tid: id\r\n\t\t})\r\n\r\n\t\tif (res.code === 1) {\r\n\t\t\t// selectedRole.value = res.data;\r\n\t\t\troleName.value = res.data.nickname;\r\n\t\t\tresist.value = res.data.resist_power;\r\n\t\t\tselectedRole.value = {\r\n\t\t\t\tid: res.data.hero_id,\r\n\t\t\t\tname: res.data.hero_name,\r\n\t\t\t\tavatar: res.data.hero_avatar\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: res.msg,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tonMounted(() => {\r\n\t\tgetHeroList()\r\n\t})\r\n</script>\r\n\r\n<style scoped>\r\n\t.page-container {\r\n\t\tbackground: #fff;\r\n\t\t/* min-height: 100vh; */\r\n\t}\r\n\r\n\t.form {\r\n\t\tpadding: 30rpx;\r\n\t}\r\n\r\n\t.form-item {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t\tmargin-bottom: 10rpx;\r\n\t\tborder-bottom: 1rpx solid #f2f2f2;\r\n\r\n\t}\r\n\r\n\t.label {\r\n\t\tfont-size: 26rpx;\r\n\t\tcolor: #333;\r\n\t\tmargin-bottom: 12rpx;\r\n\t\tdisplay: block;\r\n\t}\r\n\r\n\t.required {\r\n\t\tcolor: red;\r\n\t\tmargin-left: 8rpx;\r\n\t}\r\n\r\n\t.input,\r\n\t.input-select {\r\n\t\theight: 100rpx;\r\n\t\t/* background: #f7f8fa; */\r\n\t\tborder-radius: 12rpx;\r\n\t\tpadding: 20rpx;\r\n\t\tfont-size: 25rpx;\r\n\t\tcolor: #333;\r\n\t\ttext-align: right;\r\n\t\t/* border-radius: 50%; */\r\n\t}\r\n\r\n\t.input-select {\r\n\t\tcolor: #333 !important;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\t/* border: 1px solid #ddd; */\r\n\t}\r\n\r\n\t.form-avatar {\r\n\t\twidth: 66rpx;\r\n\t\theight: 66rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tobject-fit: cover;\r\n\t\tmargin-right: 10rpx;\r\n\t}\r\n\r\n\t.button-group {\r\n\t\t/* display: flex;\r\n\t\tjustify-content: space-between; */\r\n\t\t/* margin-top: 40rpx; */\r\n\t\tmargin: 40rpx 0rpx;\r\n\t}\r\n\r\n\t.save-btn,\r\n\t.delete-btn {\r\n\t\tflex: 1;\n\t\t/* height: 80rpx; */\r\n\t\tpadding: 5rpx 0;\r\n\t\tfont-size: 28rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t\ttext-align: center;\r\n\t\tcolor: #fff;\r\n\t}\r\n\r\n\t.save-btn {\r\n\t\tbackground-color: #1677ff;\r\n\t\tmargin: 50rpx 0rpx;\r\n\t\t/* margin-right: 20rpx; */\r\n\t}\r\n\r\n\t.delete-btn {\r\n\t\tbackground-color: #fff;\r\n\t\tborder: 1rpx solid #ccc;\r\n\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.role-list-popup {\r\n\t\tmargin: 20rpx 0rpx;\r\n\t\tmax-height: 400rpx;\r\n\t\tpadding: 20rpx;\r\n\t}\r\n\r\n\t.role-option {\r\n\t\tpadding: 24rpx;\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n\r\n\t.role-select-popup {\r\n\t\tposition: relative;\r\n\t\t/* height: 1000rpx; */\r\n\t\tdisplay: flex;\r\n\t\t/* height: 80vh; */\r\n\t\tflex-direction: column;\r\n\t\t/* height: 800rpx;\t */\r\n\t\t/* max-height: 1000rpx; */\r\n\t\t/* min-height: 1000rpx; */\r\n\t}\r\n\r\n\t.popup-header {\r\n\t\ttext-align: center;\r\n\t\tfont-size: 30rpx;\r\n\t\tpadding: 24rpx;\r\n\t\tcolor: #3366ff;\r\n\t\tborder-bottom: 1rpx solid #eee;\r\n\t}\r\n\r\n\t.fui-icon__close {\r\n\t\tposition: absolute;\r\n\t\ttop: 24rpx;\r\n\t\tright: 54rpx;\r\n\r\n\t}\r\n\r\n\t.role-group-scroll {\r\n\t\t/* flex: 1; */\r\n\t\t/* height: 800rpx;\t */\r\n\t\theight: 70vh;\r\n\t\tpadding: 20rpx;\r\n\t}\r\n\r\n\t.role-group {\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\r\n\t.group-title {\r\n\t\tfont-size: 28rpx;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-bottom: 16rpx;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.role-list {\r\n\t\tdisplay: flex;\r\n\t\tflex-wrap: wrap;\r\n\t\talign-items: center;\r\n\t\t/* justify-content: space-between; */\r\n\t\t/* gap: 20rpx 32rpx; */\r\n\t\tborder-bottom: 1rpx solid #f2f2f2;\r\n\t}\r\n\r\n\t.role-item {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\twidth: 120rpx;\r\n\t\tmargin: 20rpx 0rpx;\r\n\t}\r\n\r\n\t.role-avatar {\r\n\t\twidth: 86rpx;\r\n\t\theight: 86rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tobject-fit: cover;\r\n\t}\r\n\r\n\t.role-name {\r\n\t\tmargin-top: 8rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #444;\r\n\t\ttext-align: center;\r\n\t}\r\n</style>","import MiniProgramPage from '/Users/zhizhi/Documents/HBuilderProjects/dnf/pages/hero/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onLoad","id","onMounted"],"mappings":"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"}