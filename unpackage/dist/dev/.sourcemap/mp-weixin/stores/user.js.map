{"version":3,"file":"user.js","sources":["stores/user.js"],"sourcesContent":["import { defineStore } from 'pinia'\n\nexport const useUserStore = defineStore('user', {\n  state: () => ({\n    token: uni.getStorageSync('token') || '',\n    userInfo: uni.getStorageSync('user_info') || null\n  }),\n\n  getters: {\n    isLoggedIn: (state) => !!state.token && !!state.userInfo\n  },\n\n  actions: {\n    setToken(token) {\n      this.token = token\n      uni.setStorageSync('token', token)\n    },\n\n    setUserInfo(info) {\n      this.userInfo = info\n      uni.setStorageSync('user_info', info)\n    },\n\n    async fetchUserInfo() {\n      try {\n        const res = await uni.$http.get('/user/getUserInfo',{},{\r\n\t\t\t\t\t\tcustom: {\n\t\t\t\t\t\t\tloading: false,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\n        if (res.code === 1) {\n          this.setUserInfo(res.data)\n          return res\n        } else {\n          this.logout()\n          return null\n        }\n      } catch (e) {\n        this.logout()\n        return null\n      }\n    },\n\n    logout() {\n      this.token = ''\n      this.userInfo = null\n      uni.removeStorageSync('token')\n      uni.removeStorageSync('user_info')\n    }\n  }\n})\n"],"names":["defineStore","uni"],"mappings":";;AAEY,MAAC,eAAeA,cAAW,YAAC,QAAQ;AAAA,EAC9C,OAAO,OAAO;AAAA,IACZ,OAAOC,cAAG,MAAC,eAAe,OAAO,KAAK;AAAA,IACtC,UAAUA,cAAG,MAAC,eAAe,WAAW,KAAK;AAAA,EACjD;AAAA,EAEE,SAAS;AAAA,IACP,YAAY,CAAC,UAAU,CAAC,CAAC,MAAM,SAAS,CAAC,CAAC,MAAM;AAAA,EACjD;AAAA,EAED,SAAS;AAAA,IACP,SAAS,OAAO;AACd,WAAK,QAAQ;AACbA,0BAAI,eAAe,SAAS,KAAK;AAAA,IAClC;AAAA,IAED,YAAY,MAAM;AAChB,WAAK,WAAW;AAChBA,0BAAI,eAAe,aAAa,IAAI;AAAA,IACrC;AAAA,IAED,MAAM,gBAAgB;AACpB,UAAI;AACF,cAAM,MAAM,MAAMA,cAAG,MAAC,MAAM,IAAI,qBAAoB,IAAG;AAAA,UACzD,QAAQ;AAAA,YACP,SAAS;AAAA,UACT;AAAA,QACP,CAAM;AACE,YAAI,IAAI,SAAS,GAAG;AAClB,eAAK,YAAY,IAAI,IAAI;AACzB,iBAAO;AAAA,QACjB,OAAe;AACL,eAAK,OAAQ;AACb,iBAAO;AAAA,QACR;AAAA,MACF,SAAQ,GAAG;AACV,aAAK,OAAQ;AACb,eAAO;AAAA,MACR;AAAA,IACF;AAAA,IAED,SAAS;AACP,WAAK,QAAQ;AACb,WAAK,WAAW;AAChBA,oBAAG,MAAC,kBAAkB,OAAO;AAC7BA,oBAAG,MAAC,kBAAkB,WAAW;AAAA,IAClC;AAAA,EACF;AACH,CAAC;;"}